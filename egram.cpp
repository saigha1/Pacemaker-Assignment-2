#include "mbed.h"
#include "timer.h"

//string send_string= "";
//string ecg[200] = {"00000000000000100001011111100000", "00000000000000010001011010111011", "00000000000000010000101001000010", "00000000000000010001001000011001", "00000000000000010001110101110100", "00000000000000000001011101011010", "00000000000000000000100010100000", "00000000000000000000110101100011", "00000000000000000000110111100100", "00000000000000000010000011101011", "00000000000000000001101111000100", "00000000000000000001001100001110", "00000000000000000010011010101010", "00000000000000000001001110000110", "00000000000000000000001111110001", "00000000000000000000111110101001", "00000000000000000000111110011110", "00000000000000000000111001000001", "00000000000000010000010001100000", "00000000000000010000110000010010", "00000000000000010000100000000011", "00000000000000010001101010000111", "00000000000000010001001110101000", "00000000000000010001011001101110", "00000000000000010010001000100110", "00000000000000010010001101001000", "00000000000000010001011010011111", "00000000000000010001111100000101", "00000000000000010000000001011010", "00000000000000010001000000011000", "00000000000000000010000111001001", "00000000000000000000101110110110", "00000000000000000010011100001110", "00000000000000000010011100001110", "00000000000000000010011100001110", "00000000000000000010001100100110", "00000000000000000001111100111110", "00000000000000000001111100111110", "00000000000000000010001100100110", "00000000000000000010011100001110", "00000000000000000010001110010101", "00000000000000000001000010000101", "00000000000000000000000110110111", "00000000000000000000110001000011", "00000000000000000000110110111111", "00000000000000000001001110000110", "00000000000000000001101101010110", "00000000000000000010001100100110", "00000000000000000000000000001001", "00000000000000000010011100001110", "00000000000000000001111100111110", "00000000000000000001101101010110", "00000000000000000010001100100110", "00000000000000000000000000001001", "00000000000000000010011100001110", "00000000000000000001101101010110", "00000000000000000001101101010110", "00000000000000000010011100001110", "00000000000000000000001111110001", "00000000000000000010001100100110", "00000000000000000001001110000110", "00000000000000000001111100111110", "00000000000000000001100010101111", "00000000000000000001000110010011", "00000000000000010001101100100110", "00000000000000010001110010000101", "00000000000000010001110011111101", "00000000000000010001111000101001", "00000000000000010000100000110101", "00000000000000010001011011010000", "00000000000000000000110001101011", "00000000000000000001101011110010", "00000000000000000010001100100110", "00000000000000000001011101111001", "00000000000000000010001100100110", "00000000000000000001101011110010", "00000000000000000001101101010110", "00000000000000000001110101111101", "00000000000000010000011110001100", "00000000000000010001101101111011", "00000000000000010000010000000100", "00000000000000100001001110010011", "00000000000000100000101101011000", "00000000000000100001101110111111", "00000000000000100000100111001110", "00000000000000010000001000001111", "00000000000000010001110001000010", "00000000000000010000100011000001", "00000000000000000001010101111010", "00000000000000000001001000010100", "00000000000000000000100011010001", "00000000000000000010000010111000", "00000000000000000000000001101011", "00000000000000000001000111100001", "00000000000000000000100001101110", "00000000000000000000000001101101", "00000000000000000010001100100110", "00000000000000000000101110110110", "00000000000000000001001110000110", "00000000000000000000111110101001", "00000000000000000001101100000111", "00000000000000000001101000101011", "00000000000000010010011000100000", "00000000000000010000100001010011", "00000000000000010001000100011101", "00000000000000010001011111101010", "00000000000000010010000010010110", "00000000000000010000111101100110", "00000000000000010000011100101000", "00000000000000010001001110010100", "00000000000000010001101001101001", "00000000000000010000100000111111", "00000000000000010001100100101000", "00000000000000000000110001101011", "00000000000000000000000001101101", "00000000000000000001011101101110", "00000000000000000001101101010110", "00000000000000000001111100111110", "00000000000000000010011100001110", "00000000000000000010011100001110", "00000000000000000010001100100110", "00000000000000000001111100111110", "00000000000000000001111100111110", "00000000000000000001011101101110", "00000000000000000001100111011011", "00000000000000000001101111100011", "00000000000000000001010011011011", "00000000000000000000110000111001", "00000000000000000000010001010101", "00000000000000000010001100100110", "00000000000000000001111100111110", "00000000000000000001101101010110", "00000000000000000010001100100110", "00000000000000000000000000001001", "00000000000000000010011100001110", "00000000000000000001111100111110", "00000000000000000001101101010110", "00000000000000000010001100100110", "00000000000000000000000000001001", "00000000000000000010011100001110", "00000000000000000001101101010110", "00000000000000000001101101010110", "00000000000000000010011100001110", "00000000000000000000001111110001", "00000000000000000001101101010110", "00000000000000000010001011000010", "00000000000000000010001100001001", "00000000000000010001101100010010", "00000000000000010001111111111110", "00000000000000010010011001010011", "00000000000000010010011011000001", "00000000000000010001100001000011", "00000000000000010010001010011100", "00000000000000000010011010101011", "00000000000000000001100010101111", "00000000000000000001001110000110", "00000000000000000000011111001110", "00000000000000000000011111011001", "00000000000000000001101101100001", "00000000000000000000101110110110", "00000000000000000001101000101010", "00000000000000010000000011110001", "00000000000000010001110001000010", "00000000000000010000001000001111", "00000000000000100000110110110110", "00000000000000100001101110111111", "00000000000000100000101101011000", "00000000000000100001001110010011", "00000000000000010000010000000100", "00000000000000010001101101111011", "00000000000000010000001110100100", "00000000000000000001001000101001", "00000000000000000010001101100010", "00000000000000000010000100011101", "00000000000000000001000000001011", "00000000000000000000010111000100", "00000000000000000001010000100101", "00000000000000000001100111100100", "00000000000000000000111011010110", "00000000000000000000011111011001", "00000000000000000000111110101001", "00000000000000000010001100100110", "00000000000000000000001111100110", "00000000000000000001011101111001", "00000000000000000001010000111011", "00000000000000010000011000000100", "00000000000000010000110000100111", "00000000000000010000011011100001", "00000000000000010000011111011100", "00000000000000010000111011111000", "00000000000000010010001011101110", "00000000000000010010000010010110", "00000000000000010000010001100010", "00000000000000010000010101100101", "00000000000000010001010000001011", "00000000000000010000111100010100", "00000000000000000001011001000011", "00000000000000000000011101111111", "00000000000000000000011111011001", "00000000000000000010011100001110"};
//string timestamp[200] = {"00000000000000000000000000001010", "00000000000000000000000000010100", "00000000000000000000000000011110", "00000000000000000000000000101000", "00000000000000000000000000110010", "00000000000000000000000000111100", "00000000000000000000000001000110", "00000000000000000000000001010000", "00000000000000000000000001011010", "00000000000000000000000000000001", "00000000000000000000000000001011", "00000000000000000000000000010101", "00000000000000000000000000011111", "00000000000000000000000000101001", "00000000000000000000000000110011", "00000000000000000000000000111101", "00000000000000000000000001000111", "00000000000000000000000001010001", "00000000000000000000000001011011", "00000000000000000000000000000010", "00000000000000000000000000001100", "00000000000000000000000000010110", "00000000000000000000000000100000", "00000000000000000000000000101010", "00000000000000000000000000110100", "00000000000000000000000000111110", "00000000000000000000000001001000", "00000000000000000000000001010010", "00000000000000000000000001011100", "00000000000000000000000000000011", "00000000000000000000000000001101", "00000000000000000000000000010111", "00000000000000000000000000100001", "00000000000000000000000000101011", "00000000000000000000000000110101", "00000000000000000000000000111111", "00000000000000000000000001001001", "00000000000000000000000001010011", "00000000000000000000000001011101", "00000000000000000000000000000100", "00000000000000000000000000001110", "00000000000000000000000000011000", "00000000000000000000000000100010", "00000000000000000000000000101100", "00000000000000000000000000110110", "00000000000000000000000001000000", "00000000000000000000000001001010", "00000000000000000000000001010100", "00000000000000000000000001011110", "00000000000000000000000000000101", "00000000000000000000000000001111", "00000000000000000000000000011001", "00000000000000000000000000100011", "00000000000000000000000000101101", "00000000000000000000000000110111", "00000000000000000000000001000001", "00000000000000000000000001001011", "00000000000000000000000001010101", "00000000000000000000000001011111", "00000000000000000000000000000110", "00000000000000000000000000010000", "00000000000000000000000000011010", "00000000000000000000000000100100", "00000000000000000000000000101110", "00000000000000000000000000111000", "00000000000000000000000001000010", "00000000000000000000000001001100", "00000000000000000000000001010110", "00000000000000000000000001100000", "00000000000000000000000000000111", "00000000000000000000000000010001", "00000000000000000000000000011011", "00000000000000000000000000100101", "00000000000000000000000000101111", "00000000000000000000000000111001", "00000000000000000000000001000011", "00000000000000000000000001001101", "00000000000000000000000001010111", "00000000000000000000000001100001", "00000000000000000000000000001000", "00000000000000000000000000010010", "00000000000000000000000000011100", "00000000000000000000000000100110", "00000000000000000000000000110000", "00000000000000000000000000111010", "00000000000000000000000001000100", "00000000000000000000000001001110", "00000000000000000000000001011000", "00000000000000000000000001100010", "00000000000000000000000000001001", "00000000000000000000000000010011", "00000000000000000000000000011101", "00000000000000000000000000100111", "00000000000000000000000000110001", "00000000000000000000000000111011", "00000000000000000000000001000101", "00000000000000000000000001001111", "00000000000000000000000001011001", "00000000000000000000000001100011", "00000000000000010000000000000000", "00000000000000010000000000001010", "00000000000000010000000000010100", "00000000000000010000000000011110", "00000000000000010000000000101000", "00000000000000010000000000110010", "00000000000000010000000000111100", "00000000000000010000000001000110", "00000000000000010000000001010000", "00000000000000010000000001011010", "00000000000000010000000000000001", "00000000000000010000000000001011", "00000000000000010000000000010101", "00000000000000010000000000011111", "00000000000000010000000000101001", "00000000000000010000000000110011", "00000000000000010000000000111101", "00000000000000010000000001000111", "00000000000000010000000001010001", "00000000000000010000000001011011", "00000000000000010000000000000010", "00000000000000010000000000001100", "00000000000000010000000000010110", "00000000000000010000000000100000", "00000000000000010000000000101010", "00000000000000010000000000110100", "00000000000000010000000000111110", "00000000000000010000000001001000", "00000000000000010000000001010010", "00000000000000010000000001011100", "00000000000000010000000000000011", "00000000000000010000000000001101", "00000000000000010000000000010111", "00000000000000010000000000100001", "00000000000000010000000000101011", "00000000000000010000000000110101", "00000000000000010000000000111111", "00000000000000010000000001001001", "00000000000000010000000001010011", "00000000000000010000000001011101", "00000000000000010000000000000100", "00000000000000010000000000001110", "00000000000000010000000000011000", "00000000000000010000000000100010", "00000000000000010000000000101100", "00000000000000010000000000110110", "00000000000000010000000001000000", "00000000000000010000000001001010", "00000000000000010000000001010100", "00000000000000010000000001011110", "00000000000000010000000000000101", "00000000000000010000000000001111", "00000000000000010000000000011001", "00000000000000010000000000100011", "00000000000000010000000000101101", "00000000000000010000000000110111", "00000000000000010000000001000001", "00000000000000010000000001001011", "00000000000000010000000001010101", "00000000000000010000000001011111", "00000000000000010000000000000110", "00000000000000010000000000010000", "00000000000000010000000000011010", "00000000000000010000000000100100", "00000000000000010000000000101110", "00000000000000010000000000111000", "00000000000000010000000001000010", "00000000000000010000000001001100", "00000000000000010000000001010110", "00000000000000010000000001100000", "00000000000000010000000000000111", "00000000000000010000000000010001", "00000000000000010000000000011011", "00000000000000010000000000100101", "00000000000000010000000000101111", "00000000000000010000000000111001", "00000000000000010000000001000011", "00000000000000010000000001001101", "00000000000000010000000001010111", "00000000000000010000000001100001", "00000000000000010000000000001000", "00000000000000010000000000010010", "00000000000000010000000000011100", "00000000000000010000000000100110", "00000000000000010000000000110000", "00000000000000010000000000111010", "00000000000000010000000001000100", "00000000000000010000000001001110", "00000000000000010000000001011000", "00000000000000010000000001100010", "00000000000000010000000000001001", "00000000000000010000000000010011", "00000000000000010000000000011101", "00000000000000010000000000100111", "00000000000000010000000000110001", "00000000000000010000000000111011", "00000000000000010000000001000101", "00000000000000010000000001001111", "00000000000000010000000001011001", "00000000000000010000000001100011", "00000000000000100000000000000000"};
int counter = 0;
int egram_pending = 0;
//Serial pc(USBTX, USBRX);
AnalogIn ventricleIn(A1);
AnalogIn ground(A0);

void send_egram(void)
{
//    if (counter < 10000 && !egram_pending)
//    {
//        egram_pending = 1;
//        uint16_t reading = ventricleIn.read_u16()*3.3;
//        int intpart = reading;
//        float floatpart = reading - intpart;
//        int intfloatpart = floatpart *10000;
//        
//        char read_str[100];
//        //sprintf(read_str, "%d %d.%04d\n", counter ,intpart, intfloatpart);
//        pc.printf("%d", reading);
//        //send_string = timestamp[counter]+ecg[counter];
////        pc.printf(send_string.c_str());
//        counter++;
//        schedule_event("egram", 10);   
//    }
//    egram_pending = 0;
}